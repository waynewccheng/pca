<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<!-- saved from url=(0084)file:///C:/Users/wcc/Documents/GitHub/paulcode/finding/BiomaxOrgan10/html/mypca.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
      
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>mypca</title><meta name="generator" content="MATLAB 9.6"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2020-04-08"><meta name="DC.source" content="mypca.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h2>Contents</h2><div><ul><li><a href="file:///C:/Users/wcc/Documents/GitHub/paulcode/finding/BiomaxOrgan10/html/mypca.html#3">data conditioning -- huge difference in PCA!!!</a></li><li><a href="file:///C:/Users/wcc/Documents/GitHub/paulcode/finding/BiomaxOrgan10/html/mypca.html#4">Principal Component Analysis</a></li></ul></div><pre class="codeinput"><span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
<span class="comment">% PCA of spectral spectra</span>

<span class="comment">% 03-29-2020: First version</span>
<span class="comment">% 4-8-2020: WCC</span>

<span class="comment">% for running on WCC's computer</span>
<span class="comment">% need to addpath:</span>
<span class="comment">% C:\Users\wcc\Documents\GitHub\paulcode\finding\BiomaxOrgan10</span>
<span class="comment">% C:\Users\wcc\Desktop\paul data wsi\MatlabCode_Paul\FilterMeasurements</span>

<span class="keyword">function</span> mypca
<span class="keyword">for</span> i=1:8
    mypca_do(i)
    snapnow
<span class="keyword">end</span>
<span class="keyword">end</span>


<span class="keyword">function</span> mypca_do (organ_id)
</pre><pre class="codeinput">WCC = 1

<span class="comment">% data paths</span>

ncol = 844;
nrow = 676;

<span class="keyword">switch</span> organ_id
    <span class="keyword">case</span> 1
        organ_name = <span class="string">'BiomaxOrgan10_Bladder_M13'</span>
    <span class="keyword">case</span> 2
        organ_name = <span class="string">'BiomaxOrgan10_Brain_H10'</span>
    <span class="keyword">case</span> 3
        organ_name = <span class="string">'BiomaxOrgan10_Breast_A1'</span>
    <span class="keyword">case</span> 4
        organ_name = <span class="string">'BiomaxOrgan10_Colon_H6'</span>
    <span class="keyword">case</span> 5
        organ_name = <span class="string">'BiomaxOrgan10_Kidney_H7'</span>
    <span class="keyword">case</span> 6
        organ_name = <span class="string">'BiomaxOrgan10_Liver_H9'</span>
    <span class="keyword">case</span> 7
        organ_name = <span class="string">'BiomaxOrgan10_Lung_J7'</span>
    <span class="keyword">case</span> 8
        organ_name = <span class="string">'BiomaxOrgan10_UterineCervix_B10'</span>
<span class="keyword">end</span>

<span class="keyword">if</span> WCC == 1
    transName_path = [<span class="string">'C:\Users\wcc\Desktop\paul data wsi\Data\ProcessedData\031320\'</span> organ_name <span class="string">'\Transmittance\'</span>];
    imgTruthName_path = [<span class="string">'C:\Users\wcc\Desktop\paul data wsi\Data\ProcessedData\031320\'</span> organ_name <span class="string">'\EndResults\'</span>];
    cied65_path = <span class="string">'C:\Users\wcc\Documents\GitHub\paulcode\input\DataIlluminants\'</span>;
<span class="keyword">end</span>

<span class="comment">% File names</span>
transName = [transName_path <span class="string">'trans_mean_camera'</span>];
imgTruthName = [imgTruthName_path <span class="string">'truth.tif'</span>];

<span class="comment">% Load files</span>
temp = load(transName);

<span class="comment">% trans_array_m is 41x570544</span>
trans_array_m = temp.trans_array_m;
clearvars <span class="string">temp</span>;

<span class="comment">% data is 570544x41</span>
data = trans_array_m';
</pre><pre class="codeoutput">WCC =

     1


organ_name =

    'BiomaxOrgan10_Bladder_M13'

</pre><pre class="codeoutput">WCC =

     1


organ_name =

    'BiomaxOrgan10_Brain_H10'

</pre><pre class="codeoutput">WCC =

     1


organ_name =

    'BiomaxOrgan10_Breast_A1'

</pre><pre class="codeoutput">WCC =

     1


organ_name =

    'BiomaxOrgan10_Colon_H6'

</pre><pre class="codeoutput">WCC =

     1


organ_name =

    'BiomaxOrgan10_Kidney_H7'

</pre><pre class="codeoutput">WCC =

     1


organ_name =

    'BiomaxOrgan10_Liver_H9'

</pre><pre class="codeoutput">WCC =

     1


organ_name =

    'BiomaxOrgan10_Lung_J7'

</pre><pre class="codeoutput">WCC =

     1


organ_name =

    'BiomaxOrgan10_UterineCervix_B10'

</pre><h2 id="3">data conditioning -- huge difference in PCA!!!</h2><p>remove 380 nm</p><pre class="codeinput">data(:,1) = data(:,2);

<span class="comment">% remove 780 nm</span>
data(:,end) = data(:,end-1);
</pre><h2 id="4">Principal Component Analysis</h2><p>great tutorial: <a href="http://www.cs.otago.ac.nz/cosc453/student_tutorials/principal_components.pdf">http://www.cs.otago.ac.nz/cosc453/student_tutorials/principal_components.pdf</a> Matlab pca(): https://www.mathworks.com/help/stats/pca.html</p><pre class="codeinput">[coeff,score,latent,tsquared,explained,mu] = pca(data);

sprow = 3;
spcol = 3;

cbar1 = -3;
cbar2 = 2;

clf

<span class="keyword">for</span> i = 1:sprow*spcol-6
    subplot(sprow,spcol,i)
    im1 = score(:,i);
    im2 = reshape(im1,nrow,ncol);
    imagesc(im2)
    <span class="comment">%    colormap gray</span>
    axis <span class="string">off</span>
    <span class="comment">%axis image</span>
    <span class="comment">%caxis([cbar1 cbar2])</span>
    colorbar
    title([i])
<span class="keyword">end</span>

<span class="comment">% show histograms</span>
<span class="keyword">for</span> i = 1:3
subplot(sprow,spcol,1*spcol+i)
histogram(score(:,i))
title([i])
<span class="keyword">end</span>

<span class="comment">% show spectra</span>
subplot(sprow,spcol,sprow*spcol-2)
hold <span class="string">on</span>
plot(380:10:780,mu')
plot(380:10:780,coeff(:,1))
plot(380:10:780,coeff(:,2))
plot(380:10:780,coeff(:,3))
legend(<span class="string">'mu'</span>,<span class="string">'1'</span>,<span class="string">'2'</span>,<span class="string">'3'</span>)

<span class="comment">% show spectra</span>
subplot(sprow,spcol,sprow*spcol-1)
hold <span class="string">on</span>
plot(380:10:780,mu')
plot(380:10:780,mu'+coeff(:,1))
plot(380:10:780,mu'+coeff(:,2))
plot(380:10:780,mu'+coeff(:,3))
legend(<span class="string">'mu'</span>,<span class="string">'1'</span>,<span class="string">'2'</span>,<span class="string">'3'</span>)

<span class="comment">% show the RGB image</span>
subplot(sprow,spcol,sprow*spcol)
imgTruth = imread(imgTruthName);
image(imgTruth)
axis <span class="string">off</span>
colorbar
title(organ_name,<span class="string">'Interpreter'</span>,<span class="string">'none'</span>)

<span class="keyword">return</span>
</pre><img vspace="5" hspace="5" src="./mypca_files/mypca_01.png" alt=""> <img vspace="5" hspace="5" src="./mypca_files/mypca_02.png" alt=""> <img vspace="5" hspace="5" src="./mypca_files/mypca_03.png" alt=""> <img vspace="5" hspace="5" src="./mypca_files/mypca_04.png" alt=""> <img vspace="5" hspace="5" src="./mypca_files/mypca_05.png" alt=""> <img vspace="5" hspace="5" src="./mypca_files/mypca_06.png" alt=""> <img vspace="5" hspace="5" src="./mypca_files/mypca_07.png" alt=""> <img vspace="5" hspace="5" src="./mypca_files/mypca_08.png" alt=""> <p>% explore the Matlab pca() output results</p><p>clf</p><p>subplot(6,1,1) hold on plot(390:10:770,coeff(:,1)) plot(390:10:770,coeff(:,2)) plot(390:10:770,coeff(:,3)) xlabel('nm') ylabel('T') title('coef') legend('1','2','3')</p><p>subplot(6,1,3) plot(latent(1:5),'o-') title('latent')</p><p>subplot(6,1,5) plot(explained(1:5),'o-') title('explained')</p><p>subplot(6,1,6) plot(390:10:770,mu) xlabel('nm') ylabel('T') title('mu')</p><p>return</p><pre class="codeinput"><span class="keyword">end</span>
</pre><p class="footer"><br><a href="https://www.mathworks.com/products/matlab/">Published with MATLAB® R2019a</a><br></p></div><!--
##### SOURCE BEGIN #####
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% PCA of spectral spectra

% 03-29-2020: First version
% 4-8-2020: WCC

% for running on WCC's computer
% need to addpath:
% C:\Users\wcc\Documents\GitHub\paulcode\finding\BiomaxOrgan10
% C:\Users\wcc\Desktop\paul data wsi\MatlabCode_Paul\FilterMeasurements

function mypca
for i=1:8
    mypca_do(i)
    snapnow
end
end


function mypca_do (organ_id)

WCC = 1

% data paths

ncol = 844;
nrow = 676;

switch organ_id
    case 1
        organ_name = 'BiomaxOrgan10_Bladder_M13'
    case 2
        organ_name = 'BiomaxOrgan10_Brain_H10'
    case 3
        organ_name = 'BiomaxOrgan10_Breast_A1'
    case 4
        organ_name = 'BiomaxOrgan10_Colon_H6'
    case 5
        organ_name = 'BiomaxOrgan10_Kidney_H7'
    case 6
        organ_name = 'BiomaxOrgan10_Liver_H9'
    case 7
        organ_name = 'BiomaxOrgan10_Lung_J7'
    case 8
        organ_name = 'BiomaxOrgan10_UterineCervix_B10'
end

if WCC == 1
    transName_path = ['C:\Users\wcc\Desktop\paul data wsi\Data\ProcessedData\031320\' organ_name '\Transmittance\'];
    imgTruthName_path = ['C:\Users\wcc\Desktop\paul data wsi\Data\ProcessedData\031320\' organ_name '\EndResults\'];
    cied65_path = 'C:\Users\wcc\Documents\GitHub\paulcode\input\DataIlluminants\';
end

% File names
transName = [transName_path 'trans_mean_camera'];
imgTruthName = [imgTruthName_path 'truth.tif'];

% Load files
temp = load(transName);

% trans_array_m is 41x570544
trans_array_m = temp.trans_array_m;
clearvars temp;

% data is 570544x41
data = trans_array_m';

%% data conditioning REPLACE_WITH_DASH_DASH huge difference in PCA!!!
% remove 380 nm
data(:,1) = data(:,2);

% remove 780 nm
data(:,end) = data(:,end-1);


%% Principal Component Analysis
% great tutorial: http://www.cs.otago.ac.nz/cosc453/student_tutorials/principal_components.pdf
% Matlab pca(): https://www.mathworks.com/help/stats/pca.html

[coeff,score,latent,tsquared,explained,mu] = pca(data);

sprow = 3;
spcol = 3;

cbar1 = -3;
cbar2 = 2;

clf

for i = 1:sprow*spcol-6
    subplot(sprow,spcol,i)
    im1 = score(:,i);
    im2 = reshape(im1,nrow,ncol);
    imagesc(im2)
    %    colormap gray
    axis off
    %axis image
    %caxis([cbar1 cbar2])
    colorbar
    title([i])
end

% show histograms
for i = 1:3
subplot(sprow,spcol,1*spcol+i)
histogram(score(:,i))
title([i])
end

% show spectra
subplot(sprow,spcol,sprow*spcol-2)
hold on
plot(380:10:780,mu')
plot(380:10:780,coeff(:,1))
plot(380:10:780,coeff(:,2))
plot(380:10:780,coeff(:,3))
legend('mu','1','2','3')

% show spectra
subplot(sprow,spcol,sprow*spcol-1)
hold on
plot(380:10:780,mu')
plot(380:10:780,mu'+coeff(:,1))
plot(380:10:780,mu'+coeff(:,2))
plot(380:10:780,mu'+coeff(:,3))
legend('mu','1','2','3')

% show the RGB image
subplot(sprow,spcol,sprow*spcol)
imgTruth = imread(imgTruthName);
image(imgTruth)
axis off
colorbar
title(organ_name,'Interpreter','none')

return


%% 
% % explore the Matlab pca() output results
% 
% clf
% 
% subplot(6,1,1)
% hold on
% plot(390:10:770,coeff(:,1))
% plot(390:10:770,coeff(:,2))
% plot(390:10:770,coeff(:,3))
% xlabel('nm')
% ylabel('T')
% title('coef')
% legend('1','2','3')
% 
% subplot(6,1,3)
% plot(latent(1:5),'o-')
% title('latent')
% 
% subplot(6,1,5)
% plot(explained(1:5),'o-')
% title('explained')
% 
% subplot(6,1,6)
% plot(390:10:770,mu)
% xlabel('nm')
% ylabel('T')
% title('mu')
% 
% return

end

##### SOURCE END #####
--></body></html>